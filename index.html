<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Wars ðŸ¦žðŸ”¥</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&family=JetBrains+Mono:wght@400;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        :root {
            --bg: #0a0a0f;
            --card-bg: #12121a;
            --border: #1e1e2e;
            --primary: #ff6b35;
            --primary-glow: rgba(255, 107, 53, 0.4);
            --secondary: #ff8c42;
            --text: #e0e0e0;
            --text-muted: #6b6b7b;
            --success: #00d395;
            --danger: #ff4757;
            --warning: #ffa502;
        }
        
        * { box-sizing: border-box; }
        
        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Outfit', sans-serif;
            margin: 0;
            min-height: 100vh;
            background-image: 
                radial-gradient(ellipse at top, rgba(255, 107, 53, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at bottom, rgba(255, 140, 66, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 50, 0, 0.03) 0%, transparent 40%);
        }
        
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        .lava-glow {
            box-shadow: 0 0 30px var(--primary-glow), 0 0 60px rgba(255, 107, 53, 0.2);
        }
        
        .lava-text {
            background: linear-gradient(135deg, #ff6b35, #ff8c42, #ffaa00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1.5rem;
        }
        
        .crypto-btn {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .crypto-btn:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(255, 107, 53, 0.3);
        }
        
        .price-up { color: var(--success); }
        .price-down { color: var(--danger); }
        
        @keyframes pulse-lava {
            0%, 100% { box-shadow: 0 0 20px var(--primary-glow); }
            50% { box-shadow: 0 0 40px var(--primary-glow), 0 0 60px rgba(255, 140, 66, 0.3); }
        }
        
        .pulsing { animation: pulse-lava 2s infinite; }
        
        /* 8-bit terminal panel */
        .bit-panel {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 180px;
            background: #000;
            border-right: 3px solid #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #00ff00;
            padding: 10px;
            overflow: hidden;
            z-index: 50;
        }
        
        .bit-title {
            text-align: center;
            border-bottom: 2px solid #00ff00;
            padding-bottom: 8px;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #00ff00;
        }
        
        .bit-log {
            height: calc(100% - 140px);
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .bit-log div {
            margin-bottom: 6px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.4;
        }
        
        .bit-stats {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            border-top: 2px solid #00ff00;
            padding-top: 8px;
        }
        
        /* Always show bit panel */
        
        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .fire-flicker { animation: flicker 0.5s infinite; }
        
        .location-badge {
            background: linear-gradient(135deg, #ff6b35, #ff4500);
        }
        
        .upgrade-item {
            transition: all 0.2s;
        }
        
        .upgrade-item:hover {
            background: rgba(255, 107, 53, 0.1);
        }
        
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 1rem;
        }
        
        .modal-body {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 1.5rem;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        const { useState, useEffect, createElement: h } = React;
        
        // === CRYPTOCURRENCIES ===
        const CRYPTOS = {
            BTC: { name: 'Bitcoin', symbol: 'BTC', icon: 'â‚¿', color: '#f7931a', basePrice: 42000, volatility: 0.15 },
            ETH: { name: 'Ethereum', symbol: 'ETH', icon: 'Îž', color: '#627eea', basePrice: 2500, volatility: 0.18 },
            SOL: { name: 'Solana', symbol: 'SOL', icon: 'â—Ž', color: '#00ffa3', basePrice: 95, volatility: 0.25 },
            ADA: { name: 'Cardano', symbol: 'ADA', icon: 'â‚³', color: '#0033ad', basePrice: 0.55, volatility: 0.22 },
            DOGE: { name: 'Dogecoin', symbol: 'DOGE', icon: 'Ã', color: '#c2a633', basePrice: 0.08, volatility: 0.35 },
            XRP: { name: 'Ripple', symbol: 'XRP', icon: 'âœ•', color: '#23292f', basePrice: 0.62, volatility: 0.20 },
            LINK: { name: 'Chainlink', symbol: 'LINK', icon: 'â¬¡', color: '#375bd2', basePrice: 15, volatility: 0.23 },
            UNI: { name: 'Uniswap', symbol: 'UNI', icon: 'ðŸ¦„', color: '#ff007a', basePrice: 7, volatility: 0.28 },
            DOT: { name: 'Polkadot', icon: 'â—', color: '#e6007a', basePrice: 7, volatility: 0.25 },
            AVAX: { name: 'Avalanche', icon: 'â–²', color: '#e84142', basePrice: 35, volatility: 0.30 },
            MATIC: { name: 'Polygon', icon: 'â¬Ÿ', color: '#8247e5', basePrice: 0.85, volatility: 0.28 },
            ATOM: { name: 'Cosmos', icon: 'âš›', color: '#2e3148', basePrice: 9, volatility: 0.22 }
        };
        
        // === EXCHANGES ===
        const EXCHANGES = [
            { name: 'Coinbase', fee: 0.006, risk: 0.1, description: 'Reliable & regulated' },
            { name: 'Binance', fee: 0.004, risk: 0.15, description: 'Low fees, high liquidity' },
            { name: 'Kraken', fee: 0.005, risk: 0.08, description: 'Best security' },
            { name: 'DEX', fee: 0.008, risk: 0.25, description: 'No KYC, max privacy' }
        ];
        
        // === LOCATIONS ===
        const LOCATIONS = [
            { name: 'New York', icon: 'ðŸ—½', risk: 0.1, description: 'Financial hub' },
            { name: 'Miami', icon: 'ðŸŒ´', risk: 0.2, description: 'Crypto paradise' },
            { name: 'Los Angeles', icon: 'ðŸŒ´', risk: 0.25, description: 'Tech & celebrities' },
            { name: 'Chicago', icon: 'ðŸŒ¬ï¸', risk: 0.3, description: 'Volatile markets' },
            { name: 'Dallas', icon: 'ðŸ¤ ', risk: 0.15, description: 'Energy & stable' },
            { name: 'Las Vegas', icon: 'ðŸŽ°', risk: 0.5, description: 'High risk, high reward' },
            { name: 'Seattle', icon: 'â˜”', risk: 0.1, description: 'Tech insider info' },
            { name: 'London', icon: 'ðŸ‡¬ðŸ‡§', risk: 0.2, description: 'European markets' }
        ];
        
        // === UPGRADES ===
        const UPGRADES = {
            wallet: { name: 'Wallet+', description: '+100 capacity', cost: 500, max: 5 },
            vpn: { name: 'VPN Shield', description: 'SEC protection', cost: 1000, oneTime: true },
            hardware: { name: 'Hardware Wallet', description: 'Hack protection', cost: 2000, oneTime: true },
            premium: { name: 'Exchange Premium', description: '50% fee discount', cost: 3000, oneTime: true },
            whale: { name: 'Whale Status', description: 'Exclusive deals', cost: 10000, oneTime: true },
            jet: { name: 'Private Jet', description: 'Travel = instant', cost: 25000, oneTime: true }
        };
        
        // === GAME CONSTANTS ===
        const GAME_DAYS = 30;
        const INITIAL_CASH = 5000;
        const INITIAL_DEBT = 50000;
        const DAILY_DEBT_INTEREST = 0.03;
        
        function App() {
            // === STATE ===
            const [day, setDay] = useState(1);
            const [cash, setCash] = useState(INITIAL_CASH);
            const [debt, setDebt] = useState(INITIAL_DEBT);
            const [portfolio, setPortfolio] = useState({});
            const [prices, setPrices] = useState(() => {
                const initial = {};
                Object.entries(CRYPTOS).forEach(([sym, info]) => {
                    initial[sym] = info.basePrice;
                });
                return initial;
            });
            const [currentExchange, setCurrentExchange] = useState(EXCHANGES[0]);
            const [currentLocation, setCurrentLocation] = useState(LOCATIONS[0]);
            const [upgrades, setUpgrades] = useState({});
            const [log, setLog] = useState(['ðŸ¦ž Welcome to Crypto Wars!', 'ðŸ”¥ Molten edition - make it hot!', `Day 1 - $${INITIAL_CASH} cash, $${INITIAL_DEBT} debt`]);
            const [showModal, setShowModal] = useState(null);
            const [tradeModal, setTradeModal] = useState(null); // {symbol, type, price, max}
            const [tradeAmount, setTradeAmount] = useState('');
            const [walletCapacity, setWalletCapacity] = useState(100);
            const [defiDebt, setDefiDebt] = useState(0);
            const [defiLoans, setDefiLoans] = useState([]); // Track active loans
            
            const addLog = (msg) => setLog(l => [msg, ...l].slice(0, 20));
            
            // === HELPERS ===
            const getPortfolioValue = () => {
                return Object.entries(portfolio).reduce((sum, [sym, qty]) => {
                    return sum + (qty * prices[sym]);
                }, 0);
            };
            
            const getNetWorth = () => cash + getPortfolioValue() - debt - defiDebt;
            
            const getTotalCrypto = () => {
                return Object.values(portfolio).reduce((sum, qty) => sum + qty, 0);
            };
            
            const getCapacity = () => {
                let cap = walletCapacity;
                cap += (upgrades.wallet || 0) * 100;
                return cap;
            };
            
            const getFeeRate = () => {
                let fee = currentExchange.fee;
                if (upgrades.premium) fee *= 0.5;
                return fee;
            };
            
            // === PRICE FLUCTUATION ===
            const fluctuatePrices = () => {
                const newPrices = {};
                const locationMultiplier = 1 + (currentLocation.risk * (Math.random() - 0.5) * 0.5);
                
                Object.entries(CRYPTOS).forEach(([sym, info]) => {
                    const volatility = info.volatility;
                    const change = (Math.random() - 0.5) * 2 * volatility * locationMultiplier;
                    const clampedChange = Math.max(-0.4, Math.min(0.6, change));
                    newPrices[sym] = Math.max(info.basePrice * 0.2, prices[sym] * (1 + clampedChange));
                });
                setPrices(newPrices);
                return newPrices;
            };
            
            // === RANDOM EVENTS (30 EVENTS) ===
            const getRandomEvent = () => {
                const events = [
                    { text: 'ðŸ‹ WHALE DUMP - A whale sells everything!', effect: 'all', value: -0.30 },
                    { text: 'ðŸ“¢ ELON TWEETS - Elon mentions crypto!', effect: 'all', value: 0.20 },
                    { text: 'ðŸŽ“ SEC CRACKDOWN - New regulations!', effect: 'all', value: -0.25 },
                    { text: 'ðŸ”¥ HACK ALERT - Major exchange hacked!', effect: 'all', value: -0.35 },
                    { text: 'ðŸŒŠ BULL RUN - Market is pumping!', effect: 'all', value: 0.40 },
                    { text: 'ðŸ“‰ BLOODBATH - Massive selloff!', effect: 'all', value: -0.40 },
                    { text: 'ðŸŽ AIRDROP - Free tokens!', effect: 'cash', value: 500 },
                    { text: 'ðŸ’Ž DIAMOND HANDS - HODLers win!', effect: 'all', value: 0.15 },
                    { text: 'ðŸ• DOGE PUMP - Dogecoin parabolic!', effect: 'single', symbol: 'DOGE', value: 1.00 },
                    { text: 'ðŸ”Œ EXCHANGE DOWN - Maintenance!', effect: 'random', value: 0.20 },
                    { text: 'ðŸ¦ FED RATE - Rate decision!', effect: 'random', value: 0.15 },
                    { text: 'ðŸŒ GLOBAL RALLY - Markets up!', effect: 'all', value: 0.25 },
                    { text: 'ðŸ’¥ FLASH CRASH - Quick drop!', effect: 'flash', value: -0.30 },
                    { text: 'ðŸŽ° CASINO DAY - Gamble time!', effect: 'gamble', value: 0.50 },
                    { text: 'ðŸ“± INFLUENCER PUMP - Shilling a coin!', effect: 'random_coin', value: 0.35 },
                    { text: 'ðŸ’¸ STABLEGATE - Stablecoin chaos!', effect: 'all', value: 0.10 },
                    { text: 'ðŸ„ DEFI SUMMER - Returns!', effect: 'all', value: 0.30 },
                    { text: 'â„ï¸ WINTER IS COMING - Crypto winter!', effect: 'all', value: -0.45 },
                    { text: 'ðŸŒŸ NEW TOKEN - Hot launch!', effect: 'newtoken', value: 0.50 },
                    { text: 'ðŸš€ IPO NEWS - Exchange going public!', effect: 'all', value: 0.20 },
                    { text: 'ðŸ˜± PANIC SELL - Everyone panic!', effect: 'all', value: -0.35 },
                    { text: 'ðŸ¤ MERGER - Two chains merge!', effect: 'all', value: 0.25 },
                    { text: 'ðŸ”® VISION - You had a vision!', effect: 'doublecash', value: 2 },
                    { text: 'ðŸŽ² GAMBLE - Risk it all!', effect: 'gamble_all', value: 0.50 },
                    { text: 'ðŸ“Š WHALE WHISPER - Insider tip!', effect: 'moon', value: 0.50 },
                    { text: 'ðŸŒ¦ï¸ 4YEAR CYCLE - Cycle time!', effect: 'random', value: 0.30 },
                    { text: 'ðŸŽ­ FUD SPREAD - Fear everywhere!', effect: 'all', value: -0.20 },
                    { text: 'ðŸ’° WHALE GIFT - Whale is generous!', effect: 'cash', value: 2000 },
                    { text: 'âš¡ GAS WAR - High fees!', effect: 'fee', value: 3 },
                    { text: 'ðŸŽ† NEW YEAR - Bonus!', effect: 'cash', value: 100 }
                ];
                
                const event = events[Math.floor(Math.random() * events.length)];
                return event;
            };
            
            const applyEvent = (event) => {
                const newPrices = { ...prices };
                const symbols = Object.keys(CRYPTOS);
                
                switch(event.effect) {
                    case 'all': // All coins
                        symbols.forEach(sym => {
                            newPrices[sym] *= (1 + event.value);
                        });
                        addLog(`ðŸ“¢ ${event.text} (${event.value > 0 ? '+' : ''}${(event.value * 100).toFixed(0)}%)`);
                        break;
                        
                    case 'single': // Single coin (DOGE pump)
                        if (event.symbol && newPrices[event.symbol]) {
                            newPrices[event.symbol] *= (1 + event.value);
                            addLog(`ðŸ“¢ ${event.text} ${event.symbol} +${(event.value * 100).toFixed(0)}%!`);
                        }
                        break;
                        
                    case 'random': // Random +/- 
                        const dir = Math.random() > 0.5 ? 1 : -1;
                        symbols.forEach(sym => {
                            newPrices[sym] *= (1 + dir * event.value);
                        });
                        addLog(`ðŸ“¢ ${event.text} (${dir > 0 ? '+' : '-'}${(event.value * 100).toFixed(0)}%)`);
                        break;
                        
                    case 'random_coin': // One random coin pumps
                        const luckyCoin = symbols[Math.floor(Math.random() * symbols.length)];
                        if (newPrices[luckyCoin]) {
                            newPrices[luckyCoin] *= (1 + event.value);
                            addLog(`ðŸ“¢ ${event.text} ${luckyCoin} +${(event.value * 100).toFixed(0)}%!`);
                        }
                        break;
                        
                    case 'newtoken': // New token launch - one random coin moons
                        const newCoin = symbols[Math.floor(Math.random() * symbols.length)];
                        if (newPrices[newCoin]) {
                            newPrices[newCoin] *= (1 + event.value);
                            addLog(`ðŸŒŸ ${event.text} ${newCoin} moons +${(event.value * 100).toFixed(0)}%!`);
                        }
                        break;
                        
                    case 'flash': // Flash crash then recover
                        symbols.forEach(sym => {
                            newPrices[sym] *= 0.7; // -30%
                        });
                        addLog(`ðŸ’¥ ${event.text} -30%!`);
                        setTimeout(() => {
                            const recoverPrices = {...prices};
                            symbols.forEach(sym => {
                                recoverPrices[sym] *= 1.15; // +15% recovery
                            });
                            setPrices(recoverPrices);
                            addLog(`ðŸ“ˆ Recovered +15%!`);
                        }, 100);
                        break;
                        
                    case 'cash': // Free money
                        setCash(c => c + event.value);
                        addLog(`ðŸŽ ${event.text} +$${event.value}!`);
                        break;
                        
                    case 'doublecash': // Double your cash
                        setCash(c => c * event.value);
                        addLog(`ðŸ”® ${event.text} Cash doubled!`);
                        break;
                        
                    case 'gamble': // 50/50 gamble amount
                        const gambleAmt = Math.min(cash * 0.5, 10000);
                        if (Math.random() > 0.5) {
                            setCash(c => c + gambleAmt);
                            addLog(`ðŸŽ² ${event.text} Won $${gambleAmt.toFixed(0)}!`);
                        } else {
                            setCash(c => c - gambleAmt);
                            addLog(`ðŸŽ² ${event.text} Lost $${gambleAmt.toFixed(0)}...`);
                        }
                        break;
                        
                    case 'gamble_all': // Risk it all!
                        if (Math.random() > 0.5) {
                            setCash(c => c * 2);
                            addLog(`ðŸŽ² JACKPOT! Doubled everything!`);
                        } else {
                            setCash(c => c * 0.5);
                            addLog(`ðŸŽ² Lost half...`);
                        }
                        break;
                        
                    case 'moon': // One coin will moon tomorrow
                        const moonCoin = symbols[Math.floor(Math.random() * symbols.length)];
                        if (newPrices[moonCoin]) {
                            const bonus = newPrices[moonCoin] * event.value;
                            newPrices[moonCoin] += bonus;
                            addLog(`ðŸ“Š ${event.text} ${moonCoin} tomorrow!`);
                        }
                        break;
                        
                    case 'fee': // High gas
                        addLog(`âš¡ ${event.text} - High network fees!`);
                        break;
                        
                    default:
                        addLog(`ðŸ“¢ ${event.text}`);
                }
                
                // Clamp prices
                symbols.forEach(sym => {
                    newPrices[sym] = Math.max(CRYPTOS[sym].basePrice * 0.1, newPrices[sym]);
                });
                
                setPrices(newPrices);
            };
            
            // === NEXT DAY ===
            const nextDay = () => {
                // Apply loan shark interest (3%)
                const interest = debt * DAILY_DEBT_INTEREST;
                setDebt(d => d + interest);
                
                // Apply DeFi interest (0.5% daily) - sharks are expensive!
                if (defiDebt > 0) {
                    const defiInterest = defiDebt * 0.005;
                    setDefiDebt(d => d + defiInterest);
                    if (Math.random() < 0.2) {
                        addLog(`ðŸ¦ˆ DeFi interest: +$${defiInterest.toFixed(0)}`);
                    }
                }
                
                // Fluctuate prices
                fluctuatePrices();
                
                // Random event (30% chance)
                if (Math.random() < 0.3) {
                    const event = getRandomEvent();
                    applyEvent(event);
                }
                
                // Check upgrades
                if (upgrades.vpn && Math.random() < 0.1) {
                    addLog('ðŸ›¡ï¸ VPN protected you from SEC!');
                }
                
                if (upgrades.hardware && Math.random() < 0.05) {
                    addLog('ðŸ” Hardware wallet blocked a hack!');
                }
                
                setDay(d => d + 1);
                addLog(`ðŸ“… Day ${day + 1} - Interest: $${interest.toFixed(0)}`);
            };
            
            // === BUY (supports fractions) ===
            const buy = (symbol) => {
                const fee = getFeeRate();
                const price = prices[symbol] * (1 + fee);
                const maxQty = cash / price;
                const capacity = getCapacity() - getTotalCrypto();
                const max = Math.min(maxQty, capacity);
                
                if (max <= 0.0001) {
                    addLog(`âŒ Not enough cash for ${symbol}!`);
                    return;
                }
                
                setTradeModal({ symbol, type: 'buy', price, max });
                setTradeAmount(max.toFixed(6));
            };
            
            const sell = (symbol) => {
                const owned = portfolio[symbol] || 0;
                if (owned <= 0) {
                    addLog(`âŒ No ${symbol} to sell!`);
                    return;
                }
                const fee = getFeeRate();
                const price = prices[symbol] * (1 - fee);
                setTradeModal({ symbol, type: 'sell', price, max: owned });
                setTradeAmount(owned.toFixed(6));
            };
            
            const executeTrade = () => {
                if (!tradeModal || !tradeAmount) return;
                const amount = parseFloat(tradeAmount);
                if (!amount || amount <= 0) { setTradeModal(null); return; }
                
                const { symbol, type, price, max } = tradeModal;
                
                if (type === 'buy') {
                    const qty = Math.min(amount, max);
                    const cost = qty * price;
                    if (cost > cash) { addLog('âŒ Not enough cash!'); return; }
                    setCash(c => c - cost);
                    setPortfolio(p => ({...p, [symbol]: (p[symbol]||0) + qty}));
                    addLog(`âœ… Bought ${qty.toFixed(4)} ${symbol} for $${cost.toFixed(2)}`);
                } else {
                    const qty = Math.min(amount, max);
                    const revenue = qty * price;
                    setCash(c => c + revenue);
                    setPortfolio(p => ({...p, [symbol]: p[symbol] - qty}));
                    addLog(`ðŸ’° Sold ${qty.toFixed(4)} ${symbol} for $${revenue.toFixed(2)}`);
                }
                setTradeModal(null);
            };
            
            // === BUY ALL (max affordable of each crypto) ===
            const buyAll = () => {
                const fee = getFeeRate();
                const capacity = getCapacity() - getTotalCrypto();
                if (capacity <= 0) {
                    addLog(`âŒ Wallet full! Upgrade capacity.`);
                    return;
                }
                
                let totalSpent = 0;
                let bought = [];
                
                // Buy max of each crypto we can afford
                Object.entries(prices).forEach(([symbol, price]) => {
                    const costPerUnit = price * (1 + fee);
                    const maxAffordable = cash / costPerUnit;
                    if (maxAffordable > 0.0001 && capacity > 0) {
                        const amount = Math.min(maxAffordable, capacity);
                        const cost = amount * costPerUnit;
                        if (cost <= cash) {
                            setPortfolio(p => ({...p, [symbol]: (p[symbol] || 0) + amount}));
                            totalSpent += cost;
                            bought.push(`${amount.toFixed(4)} ${symbol}`);
                        }
                    }
                });
                
                setCash(c => c - totalSpent);
                addLog(`ðŸ¤‘ Bought ALL: ${bought.join(', ')} | Total: $${totalSpent.toFixed(2)}`);
            };
            
            // === PAY DEBT ===
            const payDebt = () => {
                const maxPay = Math.min(cash, debt);
                const pay = prompt(`Pay debt?\nOwed: $${debt.toFixed(0)}\nCash: $${cash.toFixed(0)}`, Math.floor(maxPay));
                
                if (pay && !isNaN(pay) && pay > 0) {
                    const amount = Math.min(parseFloat(pay), cash, debt);
                    setCash(c => c - amount);
                    setDebt(d => d - amount);
                    addLog(`ðŸ’³ Paid $${amount.toFixed(0)} toward debt`);
                }
            };
            
            // === DEFI LOAN (from sharks) ===
            const getDefiLoan = () => {
                const maxLoan = Math.floor(cash * 5); // Can borrow 5x cash
                if (maxLoan < 100) {
                    addLog(`âŒ Need more cash for DeFi loans!`);
                    return;
                }
                
                const amount = prompt(`ðŸ¦ˆ DEFI LOAN SHARK ðŸ¦ˆ\nMax: $${maxLoan}\nRate: 0.5% daily\nCollateral: Required`, Math.floor(maxLoan * 0.5));
                
                if (amount && !isNaN(amount) && amount > 0) {
                    const loanAmount = Math.min(parseFloat(amount), maxLoan);
                    const collateral = loanAmount * 1.5; // 150% collateral
                    
                    if (getPortfolioValue() + cash < collateral) {
                        addLog(`âŒ Need $${collateral.toFixed(0)} collateral!`);
                        return;
                    }
                    
                    setCash(c => c + loanAmount);
                    setDefiDebt(d => d + loanAmount);
                    setDefiLoans(loans => [...loans, { amount: loanAmount, collateral: collateral, day: day }]);
                    addLog(`ðŸ¦ˆ Took $${loanAmount.toFixed(0)} DeFi loan! Collateral: $${collateral.toFixed(0)}`);
                }
            };
            
            // === PAY DEFI DEBT ===
            const payDefiDebt = () => {
                if (defiDebt <= 0) {
                    addLog(`No DeFi debt to pay!`);
                    return;
                }
                
                const maxPay = Math.min(cash, defiDebt);
                const pay = prompt(`Pay DeFi debt?\nOwed: $${defiDebt.toFixed(0)}\nCash: $${cash.toFixed(0)}`, Math.floor(maxPay));
                
                if (pay && !isNaN(pay) && pay > 0) {
                    const amount = Math.min(parseFloat(pay), cash, defiDebt);
                    setCash(c => c - amount);
                    setDefiDebt(d => d - amount);
                    addLog(`ðŸ¦ˆ Paid $${amount.toFixed(0)} DeFi debt`);
                }
            };
            
            // === BUY UPGRADE ===
            const buyUpgrade = (key) => {
                const upgrade = UPGRADES[key];
                if (!upgrade) return;
                
                if (cash < upgrade.cost) {
                    addLog(`âŒ Need $${upgrade.cost} for ${upgrade.name}`);
                    return;
                }
                
                if (upgrade.oneTime && upgrades[key]) {
                    addLog(`âŒ Already have ${upgrade.name}!`);
                    return;
                }
                
                if (upgrade.max && (upgrades[key] || 0) >= upgrade.max) {
                    addLog(`âŒ Max level reached for ${upgrade.name}!`);
                    return;
                }
                
                setCash(c => c - upgrade.cost);
                setUpgrades(u => ({...u, [key]: (u[key] || 0) + 1}));
                addLog(`ðŸ”§ Purchased ${upgrade.name}!`);
            };
            
            // === TRAVEL ===
            const travel = (location) => {
                if (upgrades.jet) {
                    setCurrentLocation(location);
                    addLog(`âœˆï¸ Jet to ${location.icon} ${location.name}!`);
                    return;
                }
                
                nextDay();
                setCurrentLocation(location);
                addLog(`âœˆï¸ Traveled to ${location.icon} ${location.name} (-1 day)`);
            };
            
            // === GAME OVER ===
            const isGameOver = day > GAME_DAYS;
            const netWorth = getNetWorth();
            const score = Math.min(100, Math.max(0, (netWorth / 50000) * 100));
            
            if (isGameOver) {
                return h('div', { className: 'modal-overlay' },
                    h('div', { className: 'modal-body text-center animate__animated animate__fadeIn' },
                        h('h1', { className: 'text-4xl font-black mb-4 lava-text' }, 'ðŸ”¥ GAME OVER ðŸ”¥'),
                        h('p', { className: 'text-xl mb-2' }, `Survived ${GAME_DAYS} days`),
                        h('p', { className: 'text-2xl font-bold mb-2' }, `Final Net Worth: $${netWorth.toFixed(2)}`),
                        h('p', { className: 'text-3xl font-black mb-6', style: { color: netWorth >= 0 ? 'var(--success)' : 'var(--danger)' } }, 
                            netWorth >= 0 ? `PROFIT! Score: ${score.toFixed(1)}/100` : 'BANKRUPT! ðŸ’€'
                        ),
                        h('button', { 
                            onClick: () => window.location.reload(),
                            className: 'px-8 py-4 bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold rounded-xl text-xl hover:scale-105 transition-transform'
                        }, 'ðŸ”¥ Play Again')
                    )
                );
            }
            
            // === RENDER ===
            // 8-bit terminal panel
            const renderBitPanel = () => h('div', { className: 'bit-panel' },
                h('div', { className: 'bit-title' }, 'â—„ CRYPTO LOG â–º'),
                h('div', { className: 'bit-log' },
                    log.map((msg, i) => 
                        h('div', { key: i, style: { 
                            color: i === 0 ? '#00ff00' : i < 5 ? '#00cc00' : '#006600',
                            textShadow: i === 0 ? '0 0 5px #00ff00' : 'none'
                        }}, '> ' + msg)
                    )
                ),
                h('div', { className: 'bit-stats' },
                    h('div', null, 'DAY:' + day),
                    h('div', null, 'CASH:$' + cash.toFixed(0)),
                    h('div', null, 'DEBT:$' + debt.toFixed(0)),
                    h('div', null, 'NET:$' + getNetWorth().toFixed(0))
                )
            );
            
            return h('div', { className: 'min-h-screen pl-48 p-4 md:pl-56 md:p-6' },
                renderBitPanel(),
                h('div', { className: 'max-w-5xl mx-auto' },
                    // HEADER
                    h('div', { className: 'text-center mb-6' },
                        h('h1', { className: 'text-4xl md:text-5xl font-black tracking-tight mb-2' }, 
                            h('span', { className: 'lava-text' }, 'CRYPTO WARS')
                        ),
                        h('div', { className: 'flex justify-center gap-3 text-sm mono', style: { color: 'var(--text-muted)' } },
                            h('span', { className: 'fire-flicker' }, `ðŸ”¥ Day ${day}/${GAME_DAYS}`),
                            h('span', null, currentLocation.icon + ' ' + currentLocation.name),
                            h('span', null, currentExchange.name)
                        )
                    ),
                    
                    // STATS
                    h('div', { className: 'grid grid-cols-2 md:grid-cols-5 gap-2 mb-5' },
                        h('div', { className: 'card text-center py-2' }, 
                            h('p', { className: 'text-xs uppercase', style: { color: 'var(--text-muted)' } }, 'Cash'), 
                            h('p', { className: 'text-sm font-bold mono', style: { color: 'var(--success)' } }, '$' + cash.toFixed(0))
                        ),
                        h('div', { className: 'card text-center py-2' }, 
                            h('p', { className: 'text-xs uppercase', style: { color: 'var(--text-muted)' } }, 'Loan Shark'), 
                            h('p', { className: 'text-sm font-bold mono', style: { color: debt > INITIAL_DEBT ? 'var(--danger)' : 'var(--warning)' } }, '$' + debt.toFixed(0))
                        ),
                        h('div', { className: 'card text-center py-2' }, 
                            h('p', { className: 'text-xs uppercase', style: { color: 'var(--text-muted)' } }, 'ðŸ¦ˆ DeFi'), 
                            h('p', { className: 'text-sm font-bold mono', style: { color: defiDebt > 0 ? '#aa44ff' : 'var(--text-muted)' } }, '$' + defiDebt.toFixed(0))
                        ),
                        h('div', { className: 'card text-center py-2' }, 
                            h('p', { className: 'text-xs uppercase', style: { color: 'var(--text-muted)' } }, 'Portfolio'), 
                            h('p', { className: 'text-sm font-bold mono' }, '$' + getPortfolioValue().toFixed(0))
                        ),
                        h('div', { className: 'card text-center py-2' }, 
                            h('p', { className: 'text-xs uppercase', style: { color: 'var(--text-muted)' } }, 'Net Worth'), 
                            h('p', { className: 'text-sm font-bold mono', style: { color: netWorth >= 0 ? 'var(--success)' : 'var(--danger)' } }, '$' + netWorth.toFixed(0))
                        )
                    ),
                    
                    // QUICK ACTIONS
                    h('div', { className: 'flex gap-2 mb-5 overflow-x-auto flex-wrap' },
                        h('button', { onClick: () => setShowModal('travel'), className: 'px-4 py-2 bg-gray-800 rounded-lg font-bold text-sm' }, 'âœˆï¸ Travel'),
                        h('button', { onClick: () => setShowModal('upgrades'), className: 'px-4 py-2 bg-purple-600 rounded-lg font-bold text-sm' }, 'ðŸ”§ Upgrades'),
                        h('button', { onClick: () => setShowModal('exchange'), className: 'px-4 py-2 bg-gray-700 rounded-lg font-bold text-sm' }, currentExchange.name),
                        h('button', { onClick: () => setShowModal('portfolio'), className: 'px-4 py-2 bg-gray-700 rounded-lg font-bold text-sm' }, 'ðŸ“Š Portfolio')
                    ),
                    
                    // MARKET
                    h('div', { className: 'mb-5' },
                        h('div', { className: 'flex justify-between items-center mb-3' },
                            h('h2', { className: 'text-xl font-bold' }, 'ðŸ“ˆ Market'),
                            h('button', { 
                                onClick: buyAll,
                                className: 'px-3 py-1 bg-green-600 text-white rounded-lg font-bold text-sm hover:bg-green-500'
                            }, 'ðŸ¤‘ Buy All')
                        ),
                        h('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-3' },
                            Object.entries(CRYPTOS).map(([symbol, info]) => {
                                const price = prices[symbol];
                                const basePrice = info.basePrice;
                                const change = ((price - basePrice) / basePrice) * 100;
                                const owned = portfolio[symbol] || 0;
                                const value = owned * price;
                                
                                return h('div', { key: symbol, className: 'crypto-btn flex items-center justify-between py-1 px-2', onClick: () => buy(symbol) },
                                    h('div', { className: 'flex items-center gap-1' },
                                        h('span', { className: 'text-sm', style: { color: info.color } }, info.icon),
                                        h('span', { className: 'font-bold text-xs' }, symbol)
                                    ),
                                    h('span', { className: 'text-xs font-bold mono' }, '$' + (price < 1 ? price.toFixed(4) : price.toFixed(0))),
                                    h('span', { className: `text-xs font-bold ${change >= 0 ? 'price-up' : 'price-down'}` }, 
                                        `${change >= 0 ? '+' : ''}${change.toFixed(0)}%`
                                    )
                                );
                            })
                        )
                    ),
                    
                    // ACTIONS
                    h('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-2 mb-5' },
                        h('button', { 
                            onClick: nextDay,
                            className: 'py-3 bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold rounded-xl lava-glow pulsing'
                        }, 'â­ Next Day'),
                        h('button', { 
                            onClick: payDebt,
                            className: 'py-3 bg-blue-600 text-white font-bold rounded-xl'
                        }, 'ðŸ’³ Pay Debt'),
                        h('button', { 
                            onClick: buyAll,
                            className: 'py-3 bg-green-600 text-white font-bold rounded-xl hover:bg-green-500'
                        }, 'ðŸ¤‘ Buy All'),
                        defiDebt > 0 ? 
                            h('button', { 
                                onClick: payDefiDebt,
                                className: 'py-3 bg-purple-600 text-white font-bold rounded-xl'
                            }, 'ðŸ¦ˆ Pay DeFi') :
                            h('button', { 
                                onClick: getDefiLoan,
                                className: 'py-3 bg-purple-600 text-white font-bold rounded-xl hover:bg-purple-500'
                            }, 'ðŸ¦ˆ DeFi Loan')
                    ),
                    
                    // LOG
                    h('div', { className: 'card' },
                        h('h3', { className: 'font-bold mb-2' }, 'ðŸ“œ Activity'),
                        h('div', { className: 'space-y-1 max-h-40 overflow-y-auto' },
                            log.map((msg, i) => 
                                h('p', { key: i, className: 'text-sm mono', style: { color: i === 0 ? 'var(--text)' : 'var(--text-muted)' } }, msg)
                            )
                        )
                    ),
                    
                    // === MODALS ===
                    
                    // Travel Modal
                    showModal === 'travel' && h('div', { className: 'modal-overlay', onClick: () => setShowModal(null) },
                        h('div', { className: 'modal-body animate__animated animate__fadeIn' },
                            h('h2', { className: 'text-2xl font-black mb-4 text-center lava-text' }, 'âœˆï¸ TRAVEL'),
                            h('div', { className: 'space-y-2' },
                                LOCATIONS.map(loc => 
                                    h('button', { 
                                        key: loc.name,
                                        onClick: () => { travel(loc); setShowModal(null); },
                                        className: 'w-full p-3 bg-gray-800 rounded-lg font-bold text-left hover:bg-gray-700 flex justify-between items-center'
                                    },
                                        h('span', null, loc.icon + ' ' + loc.name),
                                        h('span', { className: 'text-xs', style: { color: loc.risk > 0.3 ? 'var(--danger)' : 'var(--success)' } }, 
                                            'Risk: ' + (loc.risk * 100).toFixed(0) + '%'
                                        )
                                    )
                                )
                            ),
                            h('button', { onClick: () => setShowModal(null), className: 'w-full py-3 bg-gray-600 rounded-lg font-bold mt-4' }, 'Cancel')
                        )
                    ),
                    
                    // Upgrades Modal
                    showModal === 'upgrades' && h('div', { className: 'modal-overlay', onClick: () => setShowModal(null) },
                        h('div', { className: 'modal-body animate__animated animate__fadeIn' },
                            h('h2', { className: 'text-2xl font-black mb-4 text-center lava-text' }, 'ðŸ”§ UPGRADES'),
                            h('div', { className: 'space-y-2' },
                                Object.entries(UPGRADES).map(([key, upg]) => 
                                    h('div', { 
                                        key: key,
                                        className: 'upgrade-item p-3 bg-gray-800 rounded-lg flex justify-between items-center'
                                    },
                                        h('div', null,
                                            h('p', { className: 'font-bold' }, upg.name),
                                            h('p', { className: 'text-xs', style: { color: 'var(--text-muted)' } }, upg.description)
                                        ),
                                        h('button', { 
                                            onClick: () => buyUpgrade(key),
                                            className: 'px-4 py-2 bg-orange-500 rounded-lg font-bold text-sm',
                                            disabled: cash < upg.cost
                                        }, '$' + upg.cost)
                                    )
                                )
                            ),
                            h('button', { onClick: () => setShowModal(null), className: 'w-full py-3 bg-gray-600 rounded-lg font-bold mt-4' }, 'Close')
                        )
                    ),
                    
                    // Portfolio Modal
                    showModal === 'portfolio' && h('div', { className: 'modal-overlay', onClick: () => setShowModal(null) },
                        h('div', { className: 'modal-body animate__animated animate__fadeIn' },
                            h('h2', { className: 'text-2xl font-black mb-4 text-center lava-text' }, 'ðŸ“Š PORTFOLIO'),
                            Object.entries(portfolio).filter(([,q]) => q > 0).map(([sym, qty]) => 
                                h('div', { key: sym, className: 'flex justify-between py-2 border-b border-gray-700' },
                                    h('span', null, CRYPTOS[sym]?.icon + ' ' + sym),
                                    h('span', { className: 'mono' }, qty.toFixed(4) + ' ($' + (qty * prices[sym]).toFixed(0) + ')')
                                )
                            ),
                            Object.values(portfolio).every(v => v === 0) && h('p', { className: 'text-center py-4', style: { color: 'var(--text-muted)' } }, 'No holdings'),
                            h('div', { className: 'mt-4 pt-4 border-t border-gray-600' },
                                h('p', { className: 'flex justify-between' }, 
                                    h('span', null, 'Total:'), 
                                    h('span', { className: 'font-bold mono' }, '$' + getPortfolioValue().toFixed(0))
                                ),
                                h('p', { className: 'flex justify-between mt-2' }, 
                                    h('span', null, 'Wallet:'), 
                                    h('span', { className: 'font-bold mono' }, getTotalCrypto().toFixed(1) + ' / ' + getCapacity())
                                )
                            ),
                            h('button', { onClick: () => setShowModal(null), className: 'w-full py-3 bg-gray-600 rounded-lg font-bold mt-4' }, 'Close')
                        )
                    ),
                    
                    // Exchange Modal
                    showModal === 'exchange' && h('div', { className: 'modal-overlay', onClick: () => setShowModal(null) },
                        h('div', { className: 'modal-body animate__animated animate__fadeIn' },
                            h('h2', { className: 'text-2xl font-black mb-4 text-center lava-text' }, 'ðŸ¦ EXCHANGE'),
                            h('div', { className: 'space-y-2' },
                                EXCHANGES.map(ex => 
                                    h('button', { 
                                        key: ex.name,
                                        onClick: () => { setCurrentExchange(ex); addLog(`Switched to ${ex.name}`); setShowModal(null); },
                                        className: 'w-full p-3 bg-gray-800 rounded-lg font-bold text-left hover:bg-gray-700'
                                    },
                                        h('div', { className: 'flex justify-between' },
                                            h('span', null, ex.name),
                                            h('span', { className: 'text-sm', style: { color: ex.fee < 0.005 ? 'var(--success)' : 'var(--text-muted)' } }, (ex.fee * 100).toFixed(1) + '% fee')
                                        ),
                                        h('p', { className: 'text-xs', style: { color: 'var(--text-muted)' } }, ex.description)
                                    )
                                )
                            ),
                            h('button', { onClick: () => setShowModal(null), className: 'w-full py-3 bg-gray-600 rounded-lg font-bold mt-4' }, 'Cancel')
                        )
                    ),
                    
                    // TRADE MODAL
                    tradeModal && h('div', { className: 'fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4', onClick: () => setTradeModal(null) },
                        h('div', { 
                            className: 'w-full max-w-sm rounded-2xl p-6',
                            style: { 
                                background: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)',
                                border: '2px solid ' + (tradeModal.type === 'buy' ? '#00ff88' : '#ff0080')
                            },
                            onClick: (e) => e.stopPropagation()
                        },
                            h('div', { className: 'flex justify-between items-center mb-4' },
                                h('div', { className: 'flex items-center gap-3' },
                                    h('span', { className: 'text-4xl', style: { color: CRYPTOS[tradeModal.symbol].color } }, CRYPTOS[tradeModal.symbol].icon),
                                    h('div', null,
                                        h('h2', { className: 'text-2xl font-bold' }, tradeModal.symbol),
                                        h('p', { className: 'text-sm text-gray-400' }, '$' + tradeModal.price.toFixed(2))
                                    )
                                ),
                                h('button', { onClick: () => setTradeModal(null), className: 'text-3xl text-gray-400' }, 'Ã—')
                            ),
                            
                            // BUY/SELL toggle buttons
                            portfolio[tradeModal.symbol] > 0 ? 
                                h('div', { className: 'flex gap-2 mb-4' },
                                    h('button', { 
                                        onClick: () => {
                                            const fee = getFeeRate();
                                            const price = prices[tradeModal.symbol] * (1 + fee);
                                            setTradeModal({...tradeModal, type: 'buy', price, max: cash / price});
                                            setTradeAmount((cash / price).toFixed(6));
                                        },
                                        className: 'flex-1 py-3 rounded-xl font-bold',
                                        style: { background: tradeModal.type === 'buy' ? '#00ff88' : '#333', color: tradeModal.type === 'buy' ? '#000' : '#fff' }
                                    }, 'BUY'),
                                    h('button', { 
                                        onClick: () => {
                                            const fee = getFeeRate();
                                            const price = prices[tradeModal.symbol] * (1 - fee);
                                            const owned = portfolio[tradeModal.symbol];
                                            setTradeModal({...tradeModal, type: 'sell', price, max: owned});
                                            setTradeAmount(owned.toFixed(6));
                                        },
                                        className: 'flex-1 py-3 rounded-xl font-bold',
                                        style: { background: tradeModal.type === 'sell' ? '#ff0080' : '#333', color: tradeModal.type === 'sell' ? '#000' : '#fff' }
                                    }, 'SELL')
                                ) : null,
                            
                            h('div', { className: 'bg-black/30 rounded-lg p-3 mb-3' },
                                h('div', { className: 'flex justify-between text-sm' },
                                    h('span', { className: 'text-gray-400' }, 'Fee:'),
                                    h('span', { className: 'text-orange-400' }, (getFeeRate() * 100).toFixed(1) + '%')
                                ),
                                portfolio[tradeModal.symbol] > 0 && h('div', { className: 'flex justify-between text-sm mt-1' },
                                    h('span', { className: 'text-gray-400' }, 'Owned:'),
                                    h('span', { className: 'text-white' }, portfolio[tradeModal.symbol].toFixed(4))
                                )
                            ),
                            h('input', {
                                type: 'number',
                                value: tradeAmount,
                                onChange: (e) => setTradeAmount(e.target.value),
                                className: 'w-full p-4 bg-black/50 border border-gray-600 rounded-xl text-xl font-bold text-white mb-3',
                                placeholder: '0.00',
                                step: 'any'
                            }),
                            h('div', { className: 'flex gap-2 mb-4' },
                                h('button', { 
                                    onClick: () => setTradeAmount(tradeModal.max.toFixed(6)),
                                    className: 'flex-1 py-2 bg-gray-700 rounded-lg font-bold'
                                }, 'MAX'),
                                h('button', { 
                                    onClick: () => setTradeAmount((tradeModal.max * 0.5).toFixed(6)),
                                    className: 'flex-1 py-2 bg-gray-700 rounded-lg font-bold'
                                }, '50%'),
                                h('button', { 
                                    onClick: () => setTradeAmount((tradeModal.max * 0.25).toFixed(6)),
                                    className: 'flex-1 py-2 bg-gray-700 rounded-lg font-bold'
                                }, '25%')
                            ),
                            h('div', { className: 'bg-black/30 rounded-lg p-3 mb-4' },
                                h('div', { className: 'flex justify-between' },
                                    h('span', { className: 'text-gray-400' }, 'Total:'),
                                    h('span', { className: 'text-xl font-bold', style: { color: tradeModal.type === 'buy' ? '#ff0080' : '#00ff88' } }, 
                                        '$' + (parseFloat(tradeAmount || 0) * tradeModal.price).toFixed(2)
                                    )
                                )
                            ),
                            h('button', {
                                onClick: executeTrade,
                                className: 'w-full py-4 rounded-xl font-bold text-lg',
                                style: { 
                                    background: tradeModal.type === 'buy' ? 'linear-gradient(135deg, #00ff88, #00cc66)' : 'linear-gradient(135deg, #ff0080, #cc0066)',
                                    color: '#000'
                                }
                            }, tradeModal.type === 'buy' ? 'ðŸš€ BUY ' + tradeModal.symbol : 'ðŸ’° SELL ' + tradeModal.symbol)
                        )
                    )
                )
            );
        }
        
        ReactDOM.createRoot(document.getElementById('root')).render(h(App));
    </script>
</body>
</html>
